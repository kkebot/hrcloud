(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1feccd65"],{2105:function(t,e,n){},"2fdb":function(t,e,n){"use strict";var a=n("5ca1"),r=n("d2c8"),i="includes";a(a.P+a.F*n("5147")(i),"String",{includes:function(t){return!!~r(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"34c6":function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"c",function(){return o});var a=n("b775"),r=function(t,e,n){return a["a"].get("/api/rule",{params:{status:t,page:e,size:n}})},i=function(t){return a["a"].post("/api/rule/unregister","",{params:{ruleId:t}})},o=function(t){return a["a"].post("/api/rule/register",t)}},5147:function(t,e,n){var a=n("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[a]=!1,!"/./"[t](e)}catch(r){}}return!0}},6762:function(t,e,n){"use strict";var a=n("5ca1"),r=n("c366")(!0);a(a.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},8454:function(t,e,n){"use strict";n.d(e,"e",function(){return a}),n.d(e,"h",function(){return r}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"a",function(){return s}),n.d(e,"g",function(){return c}),n.d(e,"b",function(){return l}),n.d(e,"f",function(){return u});n("7f7f");var a=function(t){return t?"".concat(t.name,"(").concat(t.id,")"):"/"},r=function(t){return t?"￥".concat(t.salary,"(").concat(t.id,")"):"/"},i=function(t){return t?"在职":"离职"},o=function(t){return t?"正在生效":"已撤销"},s=function(t){return t?"正在生效":"已终止"},c=o,l=function(t){return new Date(t).toLocaleString()},u=function(t){var e=new Date(t),n=e.getUTCMonth()+1,a=e.getUTCFullYear();return a+"年 "+n+"月"}},a481:function(t,e,n){"use strict";var a=n("cb7c"),r=n("4bf8"),i=n("9def"),o=n("4588"),s=n("0390"),c=n("5f1b"),l=Math.max,u=Math.min,d=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,m=function(t){return void 0===t?t:String(t)};n("214f")("replace",2,function(t,e,n,v){return[function(a,r){var i=t(this),o=void 0==a?void 0:a[e];return void 0!==o?o.call(a,i,r):n.call(String(i),a,r)},function(t,e){var r=v(n,t,this,e);if(r.done)return r.value;var d=a(t),f=String(this),p="function"===typeof e;p||(e=String(e));var y=d.global;if(y){var g=d.unicode;d.lastIndex=0}var b=[];while(1){var _=c(d,f);if(null===_)break;if(b.push(_),!y)break;var x=String(_[0]);""===x&&(d.lastIndex=s(f,i(d.lastIndex),g))}for(var k="",w=0,C=0;C<b.length;C++){_=b[C];for(var j=String(_[0]),D=l(u(o(_.index),f.length),0),$=[],R=1;R<_.length;R++)$.push(m(_[R]));var S=_.groups;if(p){var E=[j].concat($,D,f);void 0!==S&&E.push(S);var P=String(e.apply(void 0,E))}else P=h(j,f,D,$,S,e);D>=w&&(k+=f.slice(w,D)+P,w=D+j.length)}return k+f.slice(w)}];function h(t,e,a,i,o,s){var c=a+t.length,l=i.length,u=p;return void 0!==o&&(o=r(o),u=f),n.call(s,u,function(n,r){var s;switch(r.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,a);case"'":return e.slice(c);case"<":s=o[r.slice(1,-1)];break;default:var u=+r;if(0===u)return n;if(u>l){var f=d(u/10);return 0===f?n:f<=l?void 0===i[f-1]?r.charAt(1):i[f-1]+r.charAt(1):n}s=i[u-1]}return void 0===s?"":s})}})},af6c:function(t,e,n){"use strict";n.d(e,"b",function(){return m}),n.d(e,"a",function(){return v});var a=n("cebc"),r=n("a4bb"),i=n.n(r),o={text:"员工",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"姓名"},{name:"birth",text:"出生日期"},{name:"main_position_id",text:"职务",join:{table:"position",key:"id"}},{name:"administration_id",text:"所属部门",join:{table:"department",key:"id"}},{name:"scale_id",text:"薪资级别",join:{table:"pay_scale",key:"id"}}]},s={text:"岗位",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"名称"},{name:"administration_id",text:"所属部门",join:{table:"department",key:"id"}},{name:"expected_count",text:"编制人数"},{name:"actual_count",text:"当前人数"},{name:"type",text:"岗位类型"},{name:"last_normal",text:"上次满编时间"},{name:"created_at",text:"设立时间"}]},c={text:"薪资级别",primary:"id",columns:[{name:"id",hidden:!0},{name:"grade",text:"级别"},{name:"salary",text:"基础薪资"}]},l={text:"合同",primary:"id",columns:[{name:"id",hidden:!0},{name:"employee_id",text:"所属员工",join:{table:"employee",key:"id"}},{name:"description",text:"描述"},{name:"effective_on",text:"起始时间"},{name:"effective_until",text:"到期时间"}]},u={text:"合同续约",primary:"id",columns:[{name:"original_term",text:"原到期时间"},{name:"renew_term",text:"新到期时间"},{name:"employee_id",text:"所属员工",join:{table:"employee",key:"id"}},{name:"effective_on",text:"生效时间"},{name:"path",text:"审批文件"}]},d={text:"部门",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"名称"},{name:"prefix",text:"前缀"},{name:"created_at",text:"设立日期"},{name:"administration_id",text:"上级",join:{table:"department",key:"id"}}]},f={text:"薪资记录",primary:"id",columns:[{name:"id",hidden:!0},{name:"period",text:"月份"},{name:"employee_id",text:"所有者",join:{table:"employee",key:"id"}},{name:"current_scale_id",text:"当时薪资级别",join:{table:"pay_scale",key:"id"}},{name:"current_position_id",text:"时任职务",join:{table:"position",key:"id"}}]},p={employee:o,position:s,department:d,wage_record:f,pay_scale:c,contract:l,contract_renew:u},m=function(){return i()(p).map(function(t){return Object(a["a"])({},p[t],{name:t})})},v=function(){return p}},afdb:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("规则编号")]),t._v(":")]),n("Col",[n("Tag",[t._v(t._s(t.rule.id))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("状态")]),t._v(":")]),n("Col",[n("Tag",{attrs:{color:t.statusColor}},[t._v(t._s(t.statusText))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("创建时间")]),t._v(":")]),n("Col",[t._v(t._s(new Date(t.rule.createdAt).toLocaleString()))])],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("消息实体")]),t._v(":")]),n("Col",[n("Tag",[t._v(t._s(t.database[t.rule.entityType].text))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("概述")]),t._v(":")]),n("Col",[t._v(t._s(t.rule.overview))])],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("详情")]),t._v(":")]),n("Col",[t._v(t._s(t.rule.description))])],1),n("br")],1),n("div",[n("Collapse",[n("Panel",[t._v("\n        查看 SQL 语句\n        "),n("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.rule.sqlStatement))])])],1)],1)])},r=[],i=n("af6c"),o={name:"NotifyRuleView",props:{rule:{type:Object,default:function(){return{}}}},data:function(){return{database:Object(i["a"])()}},computed:{statusColor:function(){return this.rule.status?"success":"warning"},statusText:function(){return this.rule.status?"正在生效":"已失效"}}},s=o,c=n("2877"),l=Object(c["a"])(s,a,r,!1,null,"78551f89",null);e["a"]=l.exports},b23e:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",[n("page-data",{ref:"table",attrs:{"load-data":t.loadData,"use-export":!1,columns:t.columns}},[n("Row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("Col",[n("RadioGroup",{attrs:{type:"button"},on:{"on-change":t.onChange}},[n("Radio",{attrs:{label:"true"}},[n("span",[t._v("生效")])]),n("Radio",{attrs:{label:"false"}},[n("span",[t._v("失效")])]),n("Radio",{attrs:{label:null}},[n("span",[t._v("所有")])])],1)],1),n("Col",[n("Button",{attrs:{type:"success",to:{name:"NotificationSetup"}}},[t._v("添加")])],1)],1)],1),t.selected?[n("Modal",{attrs:{title:"规则详情"},model:{value:t.modalDetails,callback:function(e){t.modalDetails=e},expression:"modalDetails"}},[n("notify-rule-view",{key:t.selected.id,attrs:{rule:t.selected}})],1),n("Modal",{attrs:{title:"禁用规则","footer-hide":!0},model:{value:t.modalDisable,callback:function(e){t.modalDisable=e},expression:"modalDisable"}},[n("Alert",{key:t.selected.id,attrs:{type:"warning","show-icon":""}},[t._v("\n        此操作不可恢复！\n        "),n("template",{slot:"desc"},[t._v("\n          编号: ("+t._s(!!t.selected&&t.selected.id)+")\n          "),n("br"),t._v("\n          概述: "+t._s(!!t.selected&&t.selected.overview)+"\n        ")])],2),n("Divider"),n("Button",{attrs:{long:"",type:"error"},on:{click:function(e){(t.modal=!1)||t.disableRule()}}},[t._v("禁用规则(编号"+t._s(t.selected.id)+")")])],1)]:t._e()],2)},r=[],i=(n("a481"),n("7514"),n("f867")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ButtonGroup",{attrs:{size:"small"}},[n("Button",{attrs:{type:"primary",icon:"md-search"},on:{click:function(e){return t.$emit("check-details")}}}),n("Button",{attrs:{icon:"md-notifications"},on:{click:function(e){return t.$emit("check-read")}}}),t.rule.status?n("Button",{attrs:{type:"error",icon:"md-close"},on:{click:function(e){return t.$emit("on-disabled")}}}):t._e()],1)},s=[],c={name:"NotifyRuleOps",props:{rule:{type:Object,default:function(){return{}}}}},l=c,u=n("2877"),d=Object(u["a"])(l,o,s,!1,null,"8417438e",null),f=d.exports,p=n("8454"),m=n("34c6"),v=n("afdb"),h={components:{NotifyRuleView:v["a"],PageData:i["a"]},inject:["reload"],data:function(){var t=this;return{modalDisable:!1,modalDetails:!1,selected:null,columns:[{key:"id",title:"编号"},{key:"overview",title:"概述",render:function(t,e){var n=e.row;return t("span",n.overview)}},{key:"createdAt",title:"设置时间",render:function(t,e){var n=e.row;return t("span",Object(p["b"])(n.createdAt))}},{key:"status",title:"状态",render:function(t,e){var n=e.row;return t("Tag",{props:{color:n.status?"success":"warning"}},n.status?"正在生效":"已失效")}},{title:"操作",key:"operation",minWidth:40,render:function(e,n){var a=n.row;return e(f,{props:{rule:a},on:{"check-read":function(){return t.$router.push({name:"NotificationList",query:{ruleId:a.id}})},"check-details":function(){return(t.modalDetails=!0)&&(t.selected=a)},"on-disabled":function(){return(t.modalDisable=!0)&&(t.selected=a)}}})}}]}},methods:{loadData:function(t,e,n){var a=this,r=this.$route.query,i=r.ruleId,o=r.status;Object(m["b"])(o,t,e).then(function(t){var e=t.data,r=e.content,o=e.totalElements;n(r,o),console.log({ruleId:i}),i&&(a.selected=r.find(function(t){return t.id==i}),a.modalDetails=!0)}).catch(function(t){return a.$Notice.error({title:"获取规则失败(".concat(t.status,")"),desc:t.data.message})})},disableRule:function(){var t=this;Object(m["a"])(this.selected.id).then(function(e){t.$Notice.success({title:"禁用规则成功"}),t.reload()}).catch(function(e){return t.$Notice.error({title:"禁用规则失败".concat(e.status),desc:e.data.message})})},onChange:function(t){var e={};t&&(e.status=t),this.$router.replace({name:"RulesList",query:e}),this.$refs.table.resetPage()}}},y=h,g=Object(u["a"])(y,a,r,!1,null,"6253950c",null);e["default"]=g.exports},d2c8:function(t,e,n){var a=n("aae3"),r=n("be13");t.exports=function(t,e,n){if(a(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(t))}},dd99:function(t,e,n){"use strict";var a=n("2105"),r=n.n(a);r.a},f867:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("Col",{attrs:{span:"12"}},[n("Row",{attrs:{type:"flex",gutter:5}},[n("Col",[t.useExport?n("Button",{attrs:{type:"success"},on:{click:t.onExport}},[t._v("导出CSV")]):t._e()],1),n("Col",[n("Select",{attrs:{multiple:"","max-tag-count":3,placeholder:"选择显示列"},on:{"on-change":t.showColumns},model:{value:t.keys,callback:function(e){t.keys=e},expression:"keys"}},t._l(t.columns,function(e){return n("Option",{key:e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])}),1)],1)],1)],1),n("Col",[t._t("default")],2)],1),n("br"),n("Table",{ref:"table",staticClass:"query-list__table",attrs:{columns:t.displayed,data:t.content},on:{"on-row-dblclick":function(e){return t.$emit("on-db-click",e)}}}),n("br"),n("Row",{attrs:{type:"flex",justify:"end"}},[n("Col",[n("Page",{attrs:{current:t.page,total:t.totalElements,"page-size":t.size,"show-sizer":"","show-total":""},on:{"on-change":function(e){return t.onPage(e,t.size)},"on-page-size-change":function(e){return t.onPage(t.page,e)}}})],1)],1)],1)},r=[],i=(n("6762"),n("2fdb"),n("ac6a"),{name:"PageData",props:{columns:{type:Array,default:function(){return[]}},loadData:{type:Function,default:function(){return function(t,e,n){n([],0)}}},useExport:{type:Boolean,default:!0}},data:function(){return{keys:this.columns.map(function(t){return t.key}),displayed:this.columns.slice(),page:1,size:10,totalElements:1,content:[]}},mounted:function(){this.resetPage()},methods:{onExport:function(){var t=this;this.$refs.table.exportCsv({filename:"temp.csv",original:!1,columns:this.displayed,data:this.content.map(function(e){var n={};return t.displayed.forEach(function(t){t.noExport||(t.exportData?n[t.key]=t.exportData(e):n[t.key]=e[t.key])}),n})})},showColumns:function(){var t=this;this.displayed=this.columns.filter(function(e){return t.keys.includes(e.key)})},resetPage:function(){this.onPage(1,10)},onPage:function(t,e){this.page=t,this.size=e,this.fetchPage()},fetchPage:function(){var t=this,e=this.page,n=this.size;this.loadData(e-1,n,function(e,n){t.totalElements=n,t.content=e})},getData:function(){return this.content}}}),o=i,s=(n("dd99"),n("2877")),c=Object(s["a"])(o,a,r,!1,null,"8d711b90",null);e["a"]=c.exports}}]);
//# sourceMappingURL=chunk-1feccd65.2a27bc95.js.map