(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61091816"],{"0e8f":function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"b",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"d",function(){return c}),n.d(e,"e",function(){return u}),n.d(e,"f",function(){return s}),n.d(e,"h",function(){return d}),n.d(e,"i",function(){return l}),n.d(e,"j",function(){return f}),n.d(e,"g",function(){return p});var r=n("b775"),a=function(t){return r["a"].get("/api/department/".concat(t))},i=function(t){return r["a"].get("/api/department/".concat(t,"/details"))},o=function(){return r["a"].get("/api/department")},c=function(t){return r["a"].get("/api/department/".concat(t,"/positions"))},u=function(t){return r["a"].get("/api/department/".concat(t,"/subordinates"))},s=function(t,e){return r["a"].get("/api/department/".concat(t,"/statistics"),{params:{period:e}})},d=function(t,e){return r["a"].post("/api/department",e,{params:{departmentId:t}})},l=function(t){return r["a"].post("/api/department/shutdown","",{params:{departmentId:t}})},f=function(t,e){return r["a"].post("/api/department/update",e,{params:{departmentId:t}})},p=function(t,e){return r["a"].get("/api/department/admin",{params:{entityType:t,entityId:e}})}},"20d6":function(t,e,n){"use strict";var r=n("5ca1"),a=n("0a49")(6),i="findIndex",o=!0;i in[]&&Array(1)[i](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(i)},2105:function(t,e,n){},"2db4":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t,e){return!t||t.length<=e?t||"":t.slice(0,e)+"..."}},"2fdb":function(t,e,n){"use strict";var r=n("5ca1"),a=n("d2c8"),i="includes";r(r.P+r.F*n("5147")(i),"String",{includes:function(t){return!!~a(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},3846:function(t,e,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"3f9f":function(t,e,n){"use strict";n.d(e,"e",function(){return i}),n.d(e,"d",function(){return o}),n.d(e,"c",function(){return c}),n.d(e,"a",function(){return u}),n.d(e,"g",function(){return s}),n.d(e,"f",function(){return d}),n.d(e,"b",function(){return l});var r=n("b775"),a=n("2934"),i=function(t,e){return r["a"].post("/api/wage/update",e,{params:{wageId:t}})},o=function(t,e){return r["a"].post("/api/wage/statistic/update","",{params:{period:e,departmentId:t}})},c=function(t){return r["a"].get("/api/wage",{params:t})},u=function(t,e){return r["a"].get("/api/wage/distribute",{params:{departmentId:t,period:e}})},s=function(t,e){return r["a"].post("/api/wage/upload/current",Object(a["b"])({departmentId:t,file:e}))},d=function(t){return r["a"].post("/api/wage/upload/raw",Object(a["b"])({file:t}))},l=function(t,e,n){return r["a"].get("/api/wage/upload/result",{params:{importTimestamp:t,page:e,size:n}})}},5147:function(t,e,n){var r=n("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[r]=!1,!"/./"[t](e)}catch(a){}}return!0}},6142:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Row",{attrs:{type:"flex",gutter:20}},[n("Col",{attrs:{span:"6"}},[n("Card",{style:{"overflow-x":"auto"}},[n("Divider",{attrs:{orientation:"left"}},[t._v("部门架构")]),n("department-tree",{attrs:{"init-id":t.departmentId},on:{"node-select-change":t.onSelected}}),n("Divider"),n("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[n("Col",[n("label",[t._v("月份")])]),n("Col",[n("DatePicker",{attrs:{placeholder:"核算周期",editable:!1},model:{value:t.period,callback:function(e){t.period=e},expression:"period"}})],1)],1),n("br"),n("Button",{attrs:{long:"",disabled:!t.departmentId,type:"primary"},on:{click:function(e){return t.$refs.table.resetPage()}}},[t._v("搜索")])],1)],1),n("Col",{attrs:{span:"18"}},[n("Card",[n("Divider",{attrs:{orientation:"left"}},[t._v("员工薪资列表")]),n("wage-table",{ref:"table",attrs:{simple:!0,"load-data":t.loadData}},[n("ButtonGroup",[n("Button",{attrs:{disabled:!t.departmentId,to:{name:"MonthStatistic",query:{departmentId:t.departmentId,period:t.period.toString()}}}},[t._v("生成薪资统计")]),n("Button",{attrs:{type:"success",to:{name:"RawWageUpload"}}},[t._v("导入原始数据")])],1)],1)],1)],1)],1)},a=[],i=(n("6b54"),n("a481"),n("cadf"),n("551c"),n("f751"),n("097d"),n("e9b8")),o=n("9f8d"),c=n("3f9f"),u=n("2934"),s={components:{WageTable:i["a"],DepartmentTree:o["a"]},data:function(){var t=this.$route.query,e=t.departmentId,n=t.period;return{departmentId:e,period:n?new Date(n):new Date}},mounted:function(){this.$refs.table.resetPage()},methods:{onSelected:function(t){this.departmentId=!!t&&t.entity.id},changeRoute:function(){var t=this.departmentId,e=this.period;this.$router.replace({name:"WageDepartment",query:{departmentId:t,period:e.toString()}})},loadData:function(t,e,n){var r=this,a=this.departmentId,i=this.period;if(a){var o={page:t,size:e,entityId:a,entityType:"department",from:Object(u["a"])(i),to:Object(u["a"])(i)};Object(c["c"])(o).then(function(t){var e=t.data,a=e.content,i=e.totalElements;n(a,i),r.changeRoute()}).catch(function(t){return r.$Notice.error({title:"获取部门薪资失败(".concat(t.status,")"),desc:t.data.message})})}}}},d=s,l=(n("64ee"),n("2877")),f=Object(l["a"])(d,r,a,!1,null,"37651540",null);e["default"]=f.exports},"64ee":function(t,e,n){"use strict";var r=n("baa4"),a=n.n(r);a.a},6762:function(t,e,n){"use strict";var r=n("5ca1"),a=n("c366")(!0);r(r.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},"6b54":function(t,e,n){"use strict";n("3846");var r=n("cb7c"),a=n("0bfb"),i=n("9e1e"),o="toString",c=/./[o],u=function(t){n("2aba")(RegExp.prototype,o,t,!0)};n("79e5")(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?u(function(){var t=r(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?a.call(t):void 0)}):c.name!=o&&u(function(){return c.call(this)})},8454:function(t,e,n){"use strict";n.d(e,"e",function(){return r}),n.d(e,"h",function(){return a}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"a",function(){return c}),n.d(e,"g",function(){return u}),n.d(e,"b",function(){return s}),n.d(e,"f",function(){return d});n("7f7f");var r=function(t){return t?"".concat(t.name,"(").concat(t.id,")"):"/"},a=function(t){return t?"￥".concat(t.salary,"(").concat(t.id,")"):"/"},i=function(t){return t?"在职":"离职"},o=function(t){return t?"正在生效":"已撤销"},c=function(t){return t?"正在生效":"已终止"},u=o,s=function(t){return new Date(t).toLocaleString()},d=function(t){var e=new Date(t),n=e.getUTCMonth()+1,r=e.getUTCFullYear();return r+"年 "+n+"月"}},"9f8d":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Tree",{ref:"treeComp",attrs:{data:t.data,"load-data":t.loadData},on:{"on-select-change":t.onSelectedChange}})],1)},a=[],i=(n("ac6a"),n("6762"),n("2fdb"),n("5d73")),o=n.n(i),c=n("75fc"),u=(n("7f7f"),n("0e8f")),s={name:"DepartmentTree",props:["initId"],data:function(){return{data:[{title:"parent",loading:!1,children:[],entity:null,expand:!1}]}},computed:{root:function(){return this.data[0]}},mounted:function(){var t=this;Object(u["c"])().then(function(e){var n=e.data;t.root.title=n.name,t.root.entity=n,t.initId?Object(u["a"])(t.initId).then(function(e){var n=e.data;t.expandMounted(t.root,n.hierarchy)}):t.expandMounted(t.root,n.hierarchy)})},methods:{debug:function(){console.log(this.root),console.log(this.$refs.treeComp)},expandMounted:function(t,e){var n=this,r=t.entity,a=r.hierarchy||"/";if(a===e)return this.$set(t,"selected",!0),void this.onSelectedChange([t]);this._loadData(t,function(r){var i;(i=t.children).push.apply(i,Object(c["a"])(r)),t.expand=!0;var u=!0,s=!1,d=void 0;try{for(var l,f=o()(t.children);!(u=(l=f.next()).done);u=!0){var p=l.value,m=a+""+p.entity.id+"/";if(e.includes(m)){n.expandMounted(p,e);break}}}catch(h){s=!0,d=h}finally{try{u||null==f.return||f.return()}finally{if(s)throw d}}})},loadData:function(t,e){this._loadData(t,e)},_loadData:function(t,e){Object(u["e"])(t.entity.id).then(function(t){if(t.data){var n=[],r=t.data||[];r.forEach(function(t){return n.push({title:t.name,loading:!1,children:[],entity:t})}),e(n)}})},onSelectedChange:function(t){var e=t[t.length-1];e&&this._loadData(e,function(){}),this.$emit("node-select-change",e)}}},d=s,l=n("2877"),f=Object(l["a"])(d,r,a,!1,null,"b494006c",null);e["a"]=f.exports},a481:function(t,e,n){"use strict";var r=n("cb7c"),a=n("4bf8"),i=n("9def"),o=n("4588"),c=n("0390"),u=n("5f1b"),s=Math.max,d=Math.min,l=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,m=function(t){return void 0===t?t:String(t)};n("214f")("replace",2,function(t,e,n,h){return[function(r,a){var i=t(this),o=void 0==r?void 0:r[e];return void 0!==o?o.call(r,i,a):n.call(String(i),r,a)},function(t,e){var a=h(n,t,this,e);if(a.done)return a.value;var l=r(t),f=String(this),p="function"===typeof e;p||(e=String(e));var y=l.global;if(y){var b=l.unicode;l.lastIndex=0}var v=[];while(1){var k=u(l,f);if(null===k)break;if(v.push(k),!y)break;var w=String(k[0]);""===w&&(l.lastIndex=c(f,i(l.lastIndex),b))}for(var x="",D=0,_=0;_<v.length;_++){k=v[_];for(var O=String(k[0]),P=s(d(o(k.index),f.length),0),j=[],I=1;I<k.length;I++)j.push(m(k[I]));var $=k.groups;if(p){var S=[O].concat(j,P,f);void 0!==$&&S.push($);var C=String(e.apply(void 0,S))}else C=g(O,f,P,j,$,e);P>=D&&(x+=f.slice(D,P)+C,D=P+O.length)}return x+f.slice(D)}];function g(t,e,r,i,o,c){var u=r+t.length,s=i.length,d=p;return void 0!==o&&(o=a(o),d=f),n.call(c,d,function(n,a){var c;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(u);case"<":c=o[a.slice(1,-1)];break;default:var d=+a;if(0===d)return n;if(d>s){var f=l(d/10);return 0===f?n:f<=s?void 0===i[f-1]?a.charAt(1):i[f-1]+a.charAt(1):n}c=i[d-1]}return void 0===c?"":c})}})},baa4:function(t,e,n){},d2c8:function(t,e,n){var r=n("aae3"),a=n("be13");t.exports=function(t,e,n){if(r(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(a(t))}},dd99:function(t,e,n){"use strict";var r=n("2105"),a=n.n(r);a.a},e9b8:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("page-data",{ref:"table",attrs:{columns:t.columns,"load-data":t.loadData}},[t._t("default")],2),t.wageRecord?[n("Modal",{attrs:{"footer-hide":!0,title:"编辑工资"},model:{value:t.editModal,callback:function(e){t.editModal=e},expression:"editModal"}},[n("wage-form",{key:t.wageRecord.id,attrs:{"use-button":!0,wage:t.wageRecord},on:{"on-wage-ok":t.onSubmitWage}})],1),n("Modal",{attrs:{title:"查看工资"},model:{value:t.checkModal,callback:function(e){t.checkModal=e},expression:"checkModal"}},[n("wage-form",{key:t.wageRecord.id,attrs:{"use-button":!1,wage:t.wageRecord,readonly:!0}})],1)]:t._e()],2)},a=[],i=n("cebc"),o=(n("20d6"),n("6762"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Form",{ref:"form",attrs:{model:t.formData,"label-position":"left","label-width":80,rules:t.ruleValidate}},[n("FormItem",{attrs:{label:"核算月份",prop:"period"}},[n("DatePicker",{attrs:{disabled:!t.isSetup,editable:!1,format:"yyyy/MM"},on:{"on-change":function(e){t.formData.period=e}},model:{value:t.formData.period,callback:function(e){t.$set(t.formData,"period",e)},expression:"formData.period"}})],1),t._l(t.numericFormFields,function(e){return n("FormItem",{attrs:{label:e.title,prop:e.key}},[n("Input",{attrs:{readonly:t.readonly},model:{value:t.formData[e.key],callback:function(n){t.$set(t.formData,e.key,n)},expression:"formData[f.key]"}})],1)})],2),n("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[n("Col",[t.useButton?n("Button",{attrs:{type:"success"},on:{click:t.onOk}},[t._v("确定")]):t._e()],1),n("Col",[n("p",[n("b",[t._v("合计")]),t._v(": ￥"+t._s(t._f("numFilter")(t.earnings)))])])],1)],1)}),c=[],u=(n("c5f6"),function(t,e){var n={};return s(t,function(t,r){return e(t,r)&&(n[t]=r)}),n}),s=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},d={type:"number",message:"请输入数字",trigger:"blur",transform:function(t){return Number(t)}},l=[{key:"salary",title:"基本工资"},{key:"bonus",title:"奖金"},{key:"allowance",title:"津贴"},{key:"overtimePay",title:"加班工资"},{key:"backPay",title:"欠发工资"},{key:"payRaise",title:"加薪"},{key:"payCut",title:"减薪"}],f=l.map(function(t){return t.key}),p={name:"WageForm",props:["wage","readonly","useButton"],computed:{isSetup:function(){return!this.wage.id},earnings:{get:function(){var t=this;return f.reduce(function(e,n){return e+=Number(t.formData[n]),e},0)},set:function(t){}}},filters:{numFilter:function(t){var e=Number(t).toFixed(3),n=e.substring(0,e.length-1);return Number(n)}},data:function(){return{formData:Object(i["a"])({period:this.wage.period},u(this.wage,function(t,e){return-1!==f.indexOf(t)})),numericFormFields:l.slice(),ruleValidate:f.reduce(function(t,e){return t[e]=[d],t},{})}},methods:{onOk:function(){var t=this;this.$refs.form.validate(function(e){return!!e&&t.$emit("on-wage-ok",t.formData)})}}},m=p,h=n("2877"),g=Object(h["a"])(m,o,c,!1,null,"5a8fc5f2",null),y=g.exports,b=n("3f9f"),v=n("f867"),k=n("8454"),w=n("2db4"),x=function(t){return function(e,n){var r=n.row;return e("span",r[t].toFixed(2))}},D={name:"WageTable",components:{PageData:v["a"],WageForm:y},data:function(){var t=this,e=[{title:"核算周期",key:"period",render:function(t,e){var n=e.row;return t("span",Object(k["f"])(n.period))},exportData:function(t){return Object(k["f"])(t.period)},minWidth:20},{title:"员工",key:"employee",render:function(e,n){var r=n.row;return e("Button",{props:{size:"small"},on:{click:function(){return t.$router.push({name:"EmployeePanel",params:{id:r.employee.id},query:{tab:"wage_record"}})}}},Object(w["a"])(Object(k["e"])(r.employee),5))},exportData:function(t){return Object(k["e"])(t.employee)},minWidth:40},{title:"时任职务",key:"currentPosition",render:function(e,n){var r=n.row;return t.renderPosition(e,r.currentPosition)},exportData:function(t){return Object(k["e"])(t.currentPosition)},minWidth:40},{title:"薪级",key:"currentScale",render:function(t,e){var n=e.row;return t("Tag",Object(k["h"])(n.currentScale))},exportData:function(t){return Object(k["h"])(t.currentScale)},minWidth:40},{title:"基本工资",key:"salary",render:x("salary")},{title:"奖金",key:"bonus",render:x("bonus")},{title:"津贴",key:"allowance",render:x("allowance")},{title:"加班工资",key:"overtimePay",render:x("overtimePay")},{title:"欠发工资",key:"backPay",render:x("backPay")},{title:"加薪",key:"payRaise",render:x("payRaise")},{title:"减薪",key:"payCut",render:x("payCut")},{title:"合计",key:"earnings",render:x("earnings"),minWidth:15},{title:"查看",key:"check",render:function(e,n){var r=n.row;return e("Button",{props:{icon:"md-search",size:"small",type:"info"},on:{click:function(){return(t.wageRecord=r)&&(t.checkModal=!0)}}})},noExport:!0},{title:"操作",key:"operations",render:function(e,n){var r=n.row;return e("Button",{props:{icon:"md-create",size:"small"},on:{click:function(){return(t.wageRecord=r)&&(t.editModal=!0)}}})},noExport:!0}],n=["period","employee","currentPosition","currentScale","earnings","check","operations"],r=this.simple?e.filter(function(t){return n.includes(t.key)}):e;return{columns:this.useOperations?r:r.slice(0,-1),editModal:!1,checkModal:!1,wageRecord:null}},props:{simple:{type:Boolean,default:!1},loadData:{type:Function,default:function(){return function(t,e,n){n([],0)}}},useOperations:{type:Boolean,default:!0}},methods:{onSubmitWage:function(t){var e=this;this.editModal=!1,Object(b["e"])(this.wageRecord.id,t).then(function(t){var n=e.$refs.table.getData(),r=n.findIndex(function(t){return t.id===e.wageRecord.id});e.$set(n,r,Object(i["a"])({},n[r],t.data)),e.$Notice.success({title:"更新工资成功"})}).catch(function(t){return e.$Notice.error({title:"更新工资失败".concat(t.status),desc:t.data.message})})},resetPage:function(){this.$refs.table.resetPage()},renderPosition:function(t,e){var n=this;return e?t("Button",{props:{size:"small",type:"primary"},on:{click:function(){return n.$router.push({name:"PositionDetails",params:{id:e.id}})}}},Object(w["a"])(Object(k["e"])(e),5)):t("span","/")}}},_=D,O=Object(h["a"])(_,r,a,!1,null,"bc668ca8",null);e["a"]=O.exports},f867:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("Col",{attrs:{span:"12"}},[n("Row",{attrs:{type:"flex",gutter:5}},[n("Col",[t.useExport?n("Button",{attrs:{type:"success"},on:{click:t.onExport}},[t._v("导出CSV")]):t._e()],1),n("Col",[n("Select",{attrs:{multiple:"","max-tag-count":3,placeholder:"选择显示列"},on:{"on-change":t.showColumns},model:{value:t.keys,callback:function(e){t.keys=e},expression:"keys"}},t._l(t.columns,function(e){return n("Option",{key:e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])}),1)],1)],1)],1),n("Col",[t._t("default")],2)],1),n("br"),n("Table",{ref:"table",staticClass:"query-list__table",attrs:{columns:t.displayed,data:t.content},on:{"on-row-dblclick":function(e){return t.$emit("on-db-click",e)}}}),n("br"),n("Row",{attrs:{type:"flex",justify:"end"}},[n("Col",[n("Page",{attrs:{current:t.page,total:t.totalElements,"page-size":t.size,"show-sizer":"","show-total":""},on:{"on-change":function(e){return t.onPage(e,t.size)},"on-page-size-change":function(e){return t.onPage(t.page,e)}}})],1)],1)],1)},a=[],i=(n("6762"),n("2fdb"),n("ac6a"),{name:"PageData",props:{columns:{type:Array,default:function(){return[]}},loadData:{type:Function,default:function(){return function(t,e,n){n([],0)}}},useExport:{type:Boolean,default:!0}},data:function(){return{keys:this.columns.map(function(t){return t.key}),displayed:this.columns.slice(),page:1,size:10,totalElements:1,content:[]}},mounted:function(){this.resetPage()},methods:{onExport:function(){var t=this;this.$refs.table.exportCsv({filename:"temp.csv",original:!1,columns:this.displayed,data:this.content.map(function(e){var n={};return t.displayed.forEach(function(t){t.noExport||(t.exportData?n[t.key]=t.exportData(e):n[t.key]=e[t.key])}),n})})},showColumns:function(){var t=this;this.displayed=this.columns.filter(function(e){return t.keys.includes(e.key)})},resetPage:function(){this.onPage(1,10)},onPage:function(t,e){this.page=t,this.size=e,this.fetchPage()},fetchPage:function(){var t=this,e=this.page,n=this.size;this.loadData(e-1,n,function(e,n){t.totalElements=n,t.content=e})},getData:function(){return this.content}}}),o=i,c=(n("dd99"),n("2877")),u=Object(c["a"])(o,r,a,!1,null,"8d711b90",null);e["a"]=u.exports}}]);
//# sourceMappingURL=chunk-61091816.039bc0a3.js.map