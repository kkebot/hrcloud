(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e4092e0"],{2105:function(t,e,n){},"219d":function(t,e,n){"use strict";var a=n("479d"),r=n.n(a);r.a},"2fdb":function(t,e,n){"use strict";var a=n("5ca1"),r=n("d2c8"),i="includes";a(a.P+a.F*n("5147")(i),"String",{includes:function(t){return!!~r(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"44e0":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",[n("Divider",{attrs:{orientation:"left"}},[t._v(t._s(t.ruleId?"规则编号"+t.ruleId+" - ":"")+"消息")]),n("page-data",{ref:"table",attrs:{"load-data":t.loadData,"use-export":!1,columns:t.columns}},[n("Row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("Col",[n("ButtonGroup",[n("Button",{on:{click:t.scan}},[t._v("扫描")]),t.ruleId?n("Button",{on:{click:function(e){(t.ruleId=null)||(t.isRead=null)||t.$refs.table.resetPage()}}},[t._v("所有")]):t._e(),n("Button",{attrs:{type:"success",to:{name:"NotificationSetup"}}},[t._v("添加")])],1)],1),n("Col",[n("RadioGroup",{attrs:{type:"button"},on:{"on-change":function(e){return t.$refs.table.resetPage()}},model:{value:t.isRead,callback:function(e){t.isRead=e},expression:"isRead"}},[n("Radio",{attrs:{label:"true"}},[t._v("已读")]),n("Radio",{attrs:{label:"false"}},[t._v("未读")])],1)],1)],1)],1)],1)},r=[],i=(n("a481"),n("f867")),o=n("8454"),u=n("b775"),c=function(t){return u["a"].get("/api/notify",{params:t})},s=function(){return u["a"].post("/api/notify/scan")},l=function(t){return u["a"].post("/api/notify/read","",{params:{notificationId:t}})},d=n("af6c"),f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ButtonGroup",{attrs:{size:"small"}},[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.$emit("go-to")}}},[t._v("转到")]),t.notification.isRead?t._e():n("Button",{on:{click:function(e){return t.$emit("on-read")}}},[t._v("已读")])],1)},p=[],m={name:"NotificationOps",props:{notification:{type:Object,default:function(){return{}}}}},y=m,v=n("2877"),g=Object(v["a"])(y,f,p,!1,null,"4c156edd",null),h=g.exports,_=n("ef75"),x=n("afdb"),b={components:{NotifyRuleView:x["a"],PageData:i["a"]},inject:["reload"],data:function(){var t=this,e=Object(d["a"])(),n=this.$route.query,a=n.isRead,r=n.ruleId;return{isRead:a,ruleId:r,columns:[{key:"id",title:"消息编号"},{key:"entityType",title:"实体类型",render:function(t,n){var a=n.row;return t("span",e[a.entityType].text)}},{key:"rule_id",title:"规则编号",render:function(e,n){var a=n.row;return e("Button",{props:{icon:"md-search",size:"small"},on:{click:function(){return t.$router.push({name:"RulesList",query:{ruleId:a.ruleId}})}}},a.ruleId)}},{key:"isRead",title:"状态",render:function(t,e){var n=e.row;return t("Tag",{props:{color:n.isRead?"default":"warning"}},n.isRead?"已读":"未读")}},{key:"createdAt",title:"发现时间",align:"center",render:function(t,e){var n=e.row;return t("span",Object(o["b"])(n.createdAt))}},{title:"操作",key:"operation",render:function(e,n){var a=n.row;return e(h,{props:{notification:a},on:{"go-to":function(){return t.redirect(a)},"on-read":function(){return l(a.id).then(function(e){t.$Notice.success({title:"已标记消息(编号".concat(a.id,")为已读")}),t.reload()}).catch(function(e){return t.$Notice.error({title:"标记消息失败".concat(e.status),desc:e.data.message})})}}})}}]}},methods:{redirect:function(t){var e=this,n=t.entityType,a=t.entityId;switch(n){case"contract":case"adjustment":case"wage_record":Object(_["j"])({entityType:n,entityId:a}).then(function(t){var a=t.data;e.$router.push({name:"EmployeePanel",params:{id:a},query:{tab:n}})});break;case"position":case"department":this.$router.push({path:"/organization/".concat(n,"/").concat(a)});break}},loadData:function(t,e,n){var a=this,r=this.isRead,i=this.ruleId;c({isRead:r,ruleId:i,page:t,size:e}).then(function(t){var e=t.data,o=e.content,u=e.totalElements;a.$router.replace({name:"NotificationList",query:{isRead:r,ruleId:i}}),n(o,u)}).catch(function(t){return a.$Notice.error({title:"获取消息失败".concat(t.status),desc:t.data.message})})},scan:function(){var t=this;s().then(function(e){t.$refs.table.resetPage()}).catch(function(e){return t.$Notice.error({title:"扫描失败".concat(e.status),desc:e.data.message})})}}},k=b,w=(n("219d"),Object(v["a"])(k,a,r,!1,null,"d0e0f8fc",null));e["default"]=w.exports},"479d":function(t,e,n){},5147:function(t,e,n){var a=n("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[a]=!1,!"/./"[t](e)}catch(r){}}return!0}},6762:function(t,e,n){"use strict";var a=n("5ca1"),r=n("c366")(!0);a(a.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},8454:function(t,e,n){"use strict";n.d(e,"e",function(){return a}),n.d(e,"h",function(){return r}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"a",function(){return u}),n.d(e,"g",function(){return c}),n.d(e,"b",function(){return s}),n.d(e,"f",function(){return l});n("7f7f");var a=function(t){return t?"".concat(t.name,"(").concat(t.id,")"):"/"},r=function(t){return t?"￥".concat(t.salary,"(").concat(t.id,")"):"/"},i=function(t){return t?"在职":"离职"},o=function(t){return t?"正在生效":"已撤销"},u=function(t){return t?"正在生效":"已终止"},c=o,s=function(t){return new Date(t).toLocaleString()},l=function(t){var e=new Date(t),n=e.getUTCMonth()+1,a=e.getUTCFullYear();return a+"年 "+n+"月"}},a481:function(t,e,n){"use strict";var a=n("cb7c"),r=n("4bf8"),i=n("9def"),o=n("4588"),u=n("0390"),c=n("5f1b"),s=Math.max,l=Math.min,d=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,m=function(t){return void 0===t?t:String(t)};n("214f")("replace",2,function(t,e,n,y){return[function(a,r){var i=t(this),o=void 0==a?void 0:a[e];return void 0!==o?o.call(a,i,r):n.call(String(i),a,r)},function(t,e){var r=y(n,t,this,e);if(r.done)return r.value;var d=a(t),f=String(this),p="function"===typeof e;p||(e=String(e));var g=d.global;if(g){var h=d.unicode;d.lastIndex=0}var _=[];while(1){var x=c(d,f);if(null===x)break;if(_.push(x),!g)break;var b=String(x[0]);""===b&&(d.lastIndex=u(f,i(d.lastIndex),h))}for(var k="",w=0,j=0;j<_.length;j++){x=_[j];for(var C=String(x[0]),R=s(l(o(x.index),f.length),0),I=[],$=1;$<x.length;$++)I.push(m(x[$]));var P=x.groups;if(p){var S=[C].concat(I,R,f);void 0!==P&&S.push(P);var E=String(e.apply(void 0,S))}else E=v(C,f,R,I,P,e);R>=w&&(k+=f.slice(w,R)+E,w=R+C.length)}return k+f.slice(w)}];function v(t,e,a,i,o,u){var c=a+t.length,s=i.length,l=p;return void 0!==o&&(o=r(o),l=f),n.call(u,l,function(n,r){var u;switch(r.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,a);case"'":return e.slice(c);case"<":u=o[r.slice(1,-1)];break;default:var l=+r;if(0===l)return n;if(l>s){var f=d(l/10);return 0===f?n:f<=s?void 0===i[f-1]?r.charAt(1):i[f-1]+r.charAt(1):n}u=i[l-1]}return void 0===u?"":u})}})},af6c:function(t,e,n){"use strict";n.d(e,"b",function(){return m}),n.d(e,"a",function(){return y});var a=n("cebc"),r=n("a4bb"),i=n.n(r),o={text:"员工",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"姓名"},{name:"birth",text:"出生日期"},{name:"main_position_id",text:"职务",join:{table:"position",key:"id"}},{name:"administration_id",text:"所属部门",join:{table:"department",key:"id"}},{name:"scale_id",text:"薪资级别",join:{table:"pay_scale",key:"id"}}]},u={text:"岗位",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"名称"},{name:"administration_id",text:"所属部门",join:{table:"department",key:"id"}},{name:"expected_count",text:"编制人数"},{name:"actual_count",text:"当前人数"},{name:"type",text:"岗位类型"},{name:"last_normal",text:"上次满编时间"},{name:"created_at",text:"设立时间"}]},c={text:"薪资级别",primary:"id",columns:[{name:"id",hidden:!0},{name:"grade",text:"级别"},{name:"salary",text:"基础薪资"}]},s={text:"合同",primary:"id",columns:[{name:"id",hidden:!0},{name:"employee_id",text:"所属员工",join:{table:"employee",key:"id"}},{name:"description",text:"描述"},{name:"effective_on",text:"起始时间"},{name:"effective_until",text:"到期时间"}]},l={text:"合同续约",primary:"id",columns:[{name:"original_term",text:"原到期时间"},{name:"renew_term",text:"新到期时间"},{name:"employee_id",text:"所属员工",join:{table:"employee",key:"id"}},{name:"effective_on",text:"生效时间"},{name:"path",text:"审批文件"}]},d={text:"部门",primary:"id",columns:[{name:"id",hidden:!0},{name:"name",text:"名称"},{name:"prefix",text:"前缀"},{name:"created_at",text:"设立日期"},{name:"administration_id",text:"上级",join:{table:"department",key:"id"}}]},f={text:"薪资记录",primary:"id",columns:[{name:"id",hidden:!0},{name:"period",text:"月份"},{name:"employee_id",text:"所有者",join:{table:"employee",key:"id"}},{name:"current_scale_id",text:"当时薪资级别",join:{table:"pay_scale",key:"id"}},{name:"current_position_id",text:"时任职务",join:{table:"position",key:"id"}}]},p={employee:o,position:u,department:d,wage_record:f,pay_scale:c,contract:s,contract_renew:l},m=function(){return i()(p).map(function(t){return Object(a["a"])({},p[t],{name:t})})},y=function(){return p}},afdb:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("规则编号")]),t._v(":")]),n("Col",[n("Tag",[t._v(t._s(t.rule.id))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("状态")]),t._v(":")]),n("Col",[n("Tag",{attrs:{color:t.statusColor}},[t._v(t._s(t.statusText))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("创建时间")]),t._v(":")]),n("Col",[t._v(t._s(new Date(t.rule.createdAt).toLocaleString()))])],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("消息实体")]),t._v(":")]),n("Col",[n("Tag",[t._v(t._s(t.database[t.rule.entityType].text))])],1)],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("概述")]),t._v(":")]),n("Col",[t._v(t._s(t.rule.overview))])],1),n("br")],1),n("div",[n("Row",{attrs:{type:"flex",gutter:10,align:"middle"}},[n("Col",{attrs:{span:"4"}},[n("span",[t._v("详情")]),t._v(":")]),n("Col",[t._v(t._s(t.rule.description))])],1),n("br")],1),n("div",[n("Collapse",[n("Panel",[t._v("\n        查看 SQL 语句\n        "),n("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.rule.sqlStatement))])])],1)],1)])},r=[],i=n("af6c"),o={name:"NotifyRuleView",props:{rule:{type:Object,default:function(){return{}}}},data:function(){return{database:Object(i["a"])()}},computed:{statusColor:function(){return this.rule.status?"success":"warning"},statusText:function(){return this.rule.status?"正在生效":"已失效"}}},u=o,c=n("2877"),s=Object(c["a"])(u,a,r,!1,null,"78551f89",null);e["a"]=s.exports},d2c8:function(t,e,n){var a=n("aae3"),r=n("be13");t.exports=function(t,e,n){if(a(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(t))}},dd99:function(t,e,n){"use strict";var a=n("2105"),r=n.n(a);r.a},ef75:function(t,e,n){"use strict";n.d(e,"i",function(){return r}),n.d(e,"g",function(){return i}),n.d(e,"h",function(){return o}),n.d(e,"j",function(){return u}),n.d(e,"k",function(){return c}),n.d(e,"m",function(){return s}),n.d(e,"e",function(){return l}),n.d(e,"f",function(){return d}),n.d(e,"a",function(){return f}),n.d(e,"d",function(){return p}),n.d(e,"c",function(){return m}),n.d(e,"l",function(){return y}),n.d(e,"b",function(){return v});var a=n("b775"),r=function(t,e,n,r){return a["a"].get("/api/employee/query",{params:{entityType:t,entityId:e,page:n,size:r}})},i=function(t){return a["a"].get("/api/employee/".concat(t))},o=function(t){return a["a"].post("/api/employee",t)},u=function(t){return a["a"].get("/api/employee/owner",{params:t})},c=function(t){return a["a"].post("/api/employee/restore","",{params:{employeeId:t}})},s=function(t,e){return a["a"].post("/api/employee/update",e,{params:{employeeId:t}})},l=function(t){return a["a"].get("/api/employee/".concat(t,"/attachments"))},d=function(t,e,n){return a["a"].get("/api/contract/",{params:{page:e,size:n,employeeId:t}})},f=function(t,e){return a["a"].post("/api/adjustment",e,{params:{employeeId:t}})},p=function(t,e,n){return a["a"].get("/api/adjustment",{params:{page:e,size:n,employeeId:t}})},m=function(t,e){return a["a"].post("/api/adjustment/discharge",e,{params:{employeeId:t}})},y=function(t,e){return a["a"].post("/api/adjustment/".concat(t),e)},v=function(t,e){return e.set("employeeId",t),a["a"].post("/api/employee/password",e)}},f867:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("Col",{attrs:{span:"12"}},[n("Row",{attrs:{type:"flex",gutter:5}},[n("Col",[t.useExport?n("Button",{attrs:{type:"success"},on:{click:t.onExport}},[t._v("导出CSV")]):t._e()],1),n("Col",[n("Select",{attrs:{multiple:"","max-tag-count":3,placeholder:"选择显示列"},on:{"on-change":t.showColumns},model:{value:t.keys,callback:function(e){t.keys=e},expression:"keys"}},t._l(t.columns,function(e){return n("Option",{key:e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])}),1)],1)],1)],1),n("Col",[t._t("default")],2)],1),n("br"),n("Table",{ref:"table",staticClass:"query-list__table",attrs:{columns:t.displayed,data:t.content},on:{"on-row-dblclick":function(e){return t.$emit("on-db-click",e)}}}),n("br"),n("Row",{attrs:{type:"flex",justify:"end"}},[n("Col",[n("Page",{attrs:{current:t.page,total:t.totalElements,"page-size":t.size,"show-sizer":"","show-total":""},on:{"on-change":function(e){return t.onPage(e,t.size)},"on-page-size-change":function(e){return t.onPage(t.page,e)}}})],1)],1)],1)},r=[],i=(n("6762"),n("2fdb"),n("ac6a"),{name:"PageData",props:{columns:{type:Array,default:function(){return[]}},loadData:{type:Function,default:function(){return function(t,e,n){n([],0)}}},useExport:{type:Boolean,default:!0}},data:function(){return{keys:this.columns.map(function(t){return t.key}),displayed:this.columns.slice(),page:1,size:10,totalElements:1,content:[]}},mounted:function(){this.resetPage()},methods:{onExport:function(){var t=this;this.$refs.table.exportCsv({filename:"temp.csv",original:!1,columns:this.displayed,data:this.content.map(function(e){var n={};return t.displayed.forEach(function(t){t.noExport||(t.exportData?n[t.key]=t.exportData(e):n[t.key]=e[t.key])}),n})})},showColumns:function(){var t=this;this.displayed=this.columns.filter(function(e){return t.keys.includes(e.key)})},resetPage:function(){this.onPage(1,10)},onPage:function(t,e){this.page=t,this.size=e,this.fetchPage()},fetchPage:function(){var t=this,e=this.page,n=this.size;this.loadData(e-1,n,function(e,n){t.totalElements=n,t.content=e})},getData:function(){return this.content}}}),o=i,u=(n("dd99"),n("2877")),c=Object(u["a"])(o,a,r,!1,null,"8d711b90",null);e["a"]=c.exports}}]);
//# sourceMappingURL=chunk-3e4092e0.72cc0020.js.map