(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-638a8e0a"],{"01b0":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=[{key:"allowance",name:"津贴"},{key:"salary",name:"基础工资"},{key:"bonus",name:"奖金"},{key:"overtimePay",name:"加班工资"},{key:"backPay",name:"欠发工资"},{key:"payRaise",name:"加薪"},{key:"payCut",name:"减薪"}],r=function(){return a}},"20d6":function(e,t,n){"use strict";var a=n("5ca1"),r=n("0a49")(6),o="findIndex",i=!0;o in[]&&Array(1)[o](function(){i=!1}),a(a.P+a.F*i,"Array",{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(o)},2105:function(e,t,n){},"2db4":function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a=function(e,t){return!e||e.length<=t?e||"":e.slice(0,t)+"..."}},"2fdb":function(e,t,n){"use strict";var a=n("5ca1"),r=n("d2c8"),o="includes";a(a.P+a.F*n("5147")(o),"String",{includes:function(e){return!!~r(this,e,o).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"3f9f":function(e,t,n){"use strict";n.d(t,"e",function(){return o}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return c}),n.d(t,"g",function(){return u}),n.d(t,"f",function(){return l}),n.d(t,"b",function(){return d});var a=n("b775"),r=n("2934"),o=function(e,t){return a["a"].post("/api/wage/update",t,{params:{wageId:e}})},i=function(e,t){return a["a"].post("/api/wage/statistic/update","",{params:{period:t,departmentId:e}})},s=function(e){return a["a"].get("/api/wage",{params:e})},c=function(e,t){return a["a"].get("/api/wage/distribute",{params:{departmentId:e,period:t}})},u=function(e,t){return a["a"].post("/api/wage/upload/current",Object(r["b"])({departmentId:e,file:t}))},l=function(e){return a["a"].post("/api/wage/upload/raw",Object(r["b"])({file:e}))},d=function(e,t,n){return a["a"].get("/api/wage/upload/result",{params:{importTimestamp:e,page:t,size:n}})}},5147:function(e,t,n){var a=n("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,!"/./"[e](t)}catch(r){}}return!0}},5236:function(e,t,n){"use strict";var a=n("dd79"),r=n.n(a);r.a},6762:function(e,t,n){"use strict";var a=n("5ca1"),r=n("c366")(!0);a(a.P,"Array",{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},"6bda":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("wage-table",{ref:"table",attrs:{"use-operations":e.isAdmin,"load-data":e.loadData}},[n("Row",{attrs:{type:"flex",align:"middle",gutter:10}},[n("Col",[n("DatePicker",{attrs:{placeholder:"起始时间",editable:!1},model:{value:e.from,callback:function(t){e.from=t},expression:"from"}})],1),n("Col",[e._v("至")]),n("Col",[n("DatePicker",{attrs:{placeholder:"结束时间",editable:!1},model:{value:e.to,callback:function(t){e.to=t},expression:"to"}})],1),n("Col",[n("Button",{attrs:{type:"success"},on:{click:function(t){return e.$refs.table.resetPage()}}},[e._v("搜索")])],1)],1)],1),n("Divider",{attrs:{orientation:"left"}},[e._v("薪资折线图")]),e.wages.length>=3?[n("line-chart",{key:e.lineKey,attrs:{terms:e.stackTerms,"series-data":e.wages,indicators:e.trendAxis}})]:[n("Alert",{attrs:{type:"info","show-icon":""}},[e._v("\n      筛选数据不足\n      "),n("p",{attrs:{slot:"desc"},slot:"desc"},[e._v("请筛选三个或以上核算月份以查看薪资变化趋势")])])]],2)},r=[],o=n("e9b8"),i=n("3f9f"),s=n("2934"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-chart",{ref:"chart",staticClass:"my-chart",attrs:{theme:"macarons",options:e.lines}})},u=[],l=(n("7f7f"),n("9ca8")),d=(n("ef97"),n("d28f"),n("007d"),n("627c"),n("b11c"),{name:"LineChart",components:{"v-chart":l["a"]},props:{title:{type:String,default:""},seriesData:{type:Array,default:function(){return[]}},indicators:{type:Array,default:function(){return[]}},terms:{type:Array,default:function(){return[]}},showLabels:{type:Boolean,default:!1}},data:function(){return{lines:{title:{text:this.title},grid:{left:10,right:50,bottom:20,top:30,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},padding:[5,10]},legend:{data:this.terms},toolbox:{feature:{saveAsImage:{}}},xAxis:{boundaryGap:!1,data:this.indicators,axisTick:{show:!1}},yAxis:{type:"value",axisLabel:{formatter:function(e){return e.toFixed(2)}}},series:this.getSeries()}}},mounted:function(){console.log("LineChart mounted")},methods:{getSeries:function(){var e=this;return this.terms.map(function(t){return{name:t.name,type:"line",smooth:!0,animationDuration:2800,animationEasing:"cubicInOut",itemStyle:{},areaStyle:{},data:e.seriesData.map(function(e){return e[t.key]})}})}}}),f=d,p=(n("5236"),n("2877")),m=Object(p["a"])(f,c,u,!1,null,"69e0375a",null),y=m.exports,g=n("01b0"),h=n("ed08"),b={name:"WageManage",components:{LineChart:y,WageTable:o["a"]},props:["employeeId"],data:function(){return{isAdmin:Object(h["c"])(["ADMIN"]),from:Object(s["a"])(new Date),to:Object(s["a"])(new Date),lineKey:"",stackTerms:[{key:"earnings",name:"合计"}].concat(Object(g["a"])()),wages:[]}},computed:{trendAxis:function(){return this.wages.map(function(e){return e.period})}},methods:{loadData:function(e,t,n){var a=this,r=this.from,o=this.to,s=this.employeeId;Object(i["c"])({entityType:"employee",entityId:s,from:r,to:o,page:e,size:t}).then(function(i){var s=i.data,c=s.content,u=s.totalElements;a.wages=c,a.lineKey=r+"-"+o+"-"+e+"-"+t,console.log(a.lineKey),n(c,u)}).catch(function(e){return a.$Notice.error({title:"获取薪资失败(".concat(e.status,")"),desc:e.data.message})})}}},k=b,v=Object(p["a"])(k,a,r,!1,null,"b947f556",null);t["a"]=v.exports},d2c8:function(e,t,n){var a=n("aae3"),r=n("be13");e.exports=function(e,t,n){if(a(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(e))}},dd79:function(e,t,n){},dd99:function(e,t,n){"use strict";var a=n("2105"),r=n.n(a);r.a},e9b8:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("page-data",{ref:"table",attrs:{columns:e.columns,"load-data":e.loadData}},[e._t("default")],2),e.wageRecord?[n("Modal",{attrs:{"footer-hide":!0,title:"编辑工资"},model:{value:e.editModal,callback:function(t){e.editModal=t},expression:"editModal"}},[n("wage-form",{key:e.wageRecord.id,attrs:{"use-button":!0,wage:e.wageRecord},on:{"on-wage-ok":e.onSubmitWage}})],1),n("Modal",{attrs:{title:"查看工资"},model:{value:e.checkModal,callback:function(t){e.checkModal=t},expression:"checkModal"}},[n("wage-form",{key:e.wageRecord.id,attrs:{"use-button":!1,wage:e.wageRecord,readonly:!0}})],1)]:e._e()],2)},r=[],o=n("cebc"),i=(n("20d6"),n("6762"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Form",{ref:"form",attrs:{model:e.formData,"label-position":"left","label-width":80,rules:e.ruleValidate}},[n("FormItem",{attrs:{label:"核算月份",prop:"period"}},[n("DatePicker",{attrs:{disabled:!e.isSetup,editable:!1,format:"yyyy/MM"},on:{"on-change":function(t){e.formData.period=t}},model:{value:e.formData.period,callback:function(t){e.$set(e.formData,"period",t)},expression:"formData.period"}})],1),e._l(e.numericFormFields,function(t){return n("FormItem",{attrs:{label:t.title,prop:t.key}},[n("Input",{attrs:{readonly:e.readonly},model:{value:e.formData[t.key],callback:function(n){e.$set(e.formData,t.key,n)},expression:"formData[f.key]"}})],1)})],2),n("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[n("Col",[e.useButton?n("Button",{attrs:{type:"success"},on:{click:e.onOk}},[e._v("确定")]):e._e()],1),n("Col",[n("p",[n("b",[e._v("合计")]),e._v(": ￥"+e._s(e._f("numFilter")(e.earnings)))])])],1)],1)}),s=[],c=(n("c5f6"),function(e,t){var n={};return u(e,function(e,a){return t(e,a)&&(n[e]=a)}),n}),u=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},l={type:"number",message:"请输入数字",trigger:"blur",transform:function(e){return Number(e)}},d=[{key:"salary",title:"基本工资"},{key:"bonus",title:"奖金"},{key:"allowance",title:"津贴"},{key:"overtimePay",title:"加班工资"},{key:"backPay",title:"欠发工资"},{key:"payRaise",title:"加薪"},{key:"payCut",title:"减薪"}],f=d.map(function(e){return e.key}),p={name:"WageForm",props:["wage","readonly","useButton"],computed:{isSetup:function(){return!this.wage.id},earnings:{get:function(){var e=this;return f.reduce(function(t,n){return t+=Number(e.formData[n]),t},0)},set:function(e){}}},filters:{numFilter:function(e){var t=Number(e).toFixed(3),n=t.substring(0,t.length-1);return Number(n)}},data:function(){return{formData:Object(o["a"])({period:this.wage.period},c(this.wage,function(e,t){return-1!==f.indexOf(e)})),numericFormFields:d.slice(),ruleValidate:f.reduce(function(e,t){return e[t]=[l],e},{})}},methods:{onOk:function(){var e=this;this.$refs.form.validate(function(t){return!!t&&e.$emit("on-wage-ok",e.formData)})}}},m=p,y=n("2877"),g=Object(y["a"])(m,i,s,!1,null,"5a8fc5f2",null),h=g.exports,b=n("3f9f"),k=n("f867"),v=n("8454"),w=n("2db4"),x=function(e){return function(t,n){var a=n.row;return t("span",a[e].toFixed(2))}},D={name:"WageTable",components:{PageData:k["a"],WageForm:h},data:function(){var e=this,t=[{title:"核算周期",key:"period",render:function(e,t){var n=t.row;return e("span",Object(v["f"])(n.period))},exportData:function(e){return Object(v["f"])(e.period)},minWidth:20},{title:"员工",key:"employee",render:function(t,n){var a=n.row;return t("Button",{props:{size:"small"},on:{click:function(){return e.$router.push({name:"EmployeePanel",params:{id:a.employee.id},query:{tab:"wage_record"}})}}},Object(w["a"])(Object(v["e"])(a.employee),5))},exportData:function(e){return Object(v["e"])(e.employee)},minWidth:40},{title:"时任职务",key:"currentPosition",render:function(t,n){var a=n.row;return e.renderPosition(t,a.currentPosition)},exportData:function(e){return Object(v["e"])(e.currentPosition)},minWidth:40},{title:"薪级",key:"currentScale",render:function(e,t){var n=t.row;return e("Tag",Object(v["h"])(n.currentScale))},exportData:function(e){return Object(v["h"])(e.currentScale)},minWidth:40},{title:"基本工资",key:"salary",render:x("salary")},{title:"奖金",key:"bonus",render:x("bonus")},{title:"津贴",key:"allowance",render:x("allowance")},{title:"加班工资",key:"overtimePay",render:x("overtimePay")},{title:"欠发工资",key:"backPay",render:x("backPay")},{title:"加薪",key:"payRaise",render:x("payRaise")},{title:"减薪",key:"payCut",render:x("payCut")},{title:"合计",key:"earnings",render:x("earnings"),minWidth:15},{title:"查看",key:"check",render:function(t,n){var a=n.row;return t("Button",{props:{icon:"md-search",size:"small",type:"info"},on:{click:function(){return(e.wageRecord=a)&&(e.checkModal=!0)}}})},noExport:!0},{title:"操作",key:"operations",render:function(t,n){var a=n.row;return t("Button",{props:{icon:"md-create",size:"small"},on:{click:function(){return(e.wageRecord=a)&&(e.editModal=!0)}}})},noExport:!0}],n=["period","employee","currentPosition","currentScale","earnings","check","operations"],a=this.simple?t.filter(function(e){return n.includes(e.key)}):t;return{columns:this.useOperations?a:a.slice(0,-1),editModal:!1,checkModal:!1,wageRecord:null}},props:{simple:{type:Boolean,default:!1},loadData:{type:Function,default:function(){return function(e,t,n){n([],0)}}},useOperations:{type:Boolean,default:!0}},methods:{onSubmitWage:function(e){var t=this;this.editModal=!1,Object(b["e"])(this.wageRecord.id,e).then(function(e){var n=t.$refs.table.getData(),a=n.findIndex(function(e){return e.id===t.wageRecord.id});t.$set(n,a,Object(o["a"])({},n[a],e.data)),t.$Notice.success({title:"更新工资成功"})}).catch(function(e){return t.$Notice.error({title:"更新工资失败".concat(e.status),desc:e.data.message})})},resetPage:function(){this.$refs.table.resetPage()},renderPosition:function(e,t){var n=this;return t?e("Button",{props:{size:"small",type:"primary"},on:{click:function(){return n.$router.push({name:"PositionDetails",params:{id:t.id}})}}},Object(w["a"])(Object(v["e"])(t),5)):e("span","/")}}},P=D,O=Object(y["a"])(P,a,r,!1,null,"bc668ca8",null);t["a"]=O.exports},f867:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[n("Col",{attrs:{span:"12"}},[n("Row",{attrs:{type:"flex",gutter:5}},[n("Col",[e.useExport?n("Button",{attrs:{type:"success"},on:{click:e.onExport}},[e._v("导出CSV")]):e._e()],1),n("Col",[n("Select",{attrs:{multiple:"","max-tag-count":3,placeholder:"选择显示列"},on:{"on-change":e.showColumns},model:{value:e.keys,callback:function(t){e.keys=t},expression:"keys"}},e._l(e.columns,function(t){return n("Option",{key:t.key,attrs:{value:t.key}},[e._v(e._s(t.title))])}),1)],1)],1)],1),n("Col",[e._t("default")],2)],1),n("br"),n("Table",{ref:"table",staticClass:"query-list__table",attrs:{columns:e.displayed,data:e.content},on:{"on-row-dblclick":function(t){return e.$emit("on-db-click",t)}}}),n("br"),n("Row",{attrs:{type:"flex",justify:"end"}},[n("Col",[n("Page",{attrs:{current:e.page,total:e.totalElements,"page-size":e.size,"show-sizer":"","show-total":""},on:{"on-change":function(t){return e.onPage(t,e.size)},"on-page-size-change":function(t){return e.onPage(e.page,t)}}})],1)],1)],1)},r=[],o=(n("6762"),n("2fdb"),n("ac6a"),{name:"PageData",props:{columns:{type:Array,default:function(){return[]}},loadData:{type:Function,default:function(){return function(e,t,n){n([],0)}}},useExport:{type:Boolean,default:!0}},data:function(){return{keys:this.columns.map(function(e){return e.key}),displayed:this.columns.slice(),page:1,size:10,totalElements:1,content:[]}},mounted:function(){this.resetPage()},methods:{onExport:function(){var e=this;this.$refs.table.exportCsv({filename:"temp.csv",original:!1,columns:this.displayed,data:this.content.map(function(t){var n={};return e.displayed.forEach(function(e){e.noExport||(e.exportData?n[e.key]=e.exportData(t):n[e.key]=t[e.key])}),n})})},showColumns:function(){var e=this;this.displayed=this.columns.filter(function(t){return e.keys.includes(t.key)})},resetPage:function(){this.onPage(1,10)},onPage:function(e,t){this.page=e,this.size=t,this.fetchPage()},fetchPage:function(){var e=this,t=this.page,n=this.size;this.loadData(t-1,n,function(t,n){e.totalElements=n,e.content=t})},getData:function(){return this.content}}}),i=o,s=(n("dd99"),n("2877")),c=Object(s["a"])(i,a,r,!1,null,"8d711b90",null);t["a"]=c.exports}}]);
//# sourceMappingURL=chunk-638a8e0a.b60dc651.js.map